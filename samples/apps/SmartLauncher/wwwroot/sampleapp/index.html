<!DOCTYPE html>
<html>
    <head>
        <title>Sample app</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
    </head>
    <body>
    
    <div class="container">
        <h1>Microsoft FHIR Server SMART on FHIR Sample App</h1>

        <div class="row">
            <h2>Patient Resource</h2>
            <textarea id="patientfield" style="width: 20cm; height: 5cm;"></textarea>
        </div>

        <div class="row">
            <h2>Token Response</h2>
            <textarea id="tokenresponsefield" style="width: 20cm; height: 5cm;"></textarea>
        </div>
    </div>

    <script type="text/javascript">
        function log(txt) {
            document.getElementsByTagName("pre")[0].innerText += txt + "\n";
        }

        (
            async function boo() {
                let client;
                try {
                    client = await FHIR.oauth2.ready();
                } catch (error) {
                    console.error('Error during authentication:')
                    console.error(error);
                    return;
                }
                console.log('Oh. Oh! We have authenticated!!1!');
                try {
                    const patient = await client.patient.read();
                    $('#patientfield').val(JSON.stringify(patient, null, 4));
                    $('#tokenresponsefield').val(JSON.stringify(client.state.tokenResponse, null, 4));
                } catch (error) {
                    console.error('Error while fetching patient data:');
                    console.error(error);
                    return;
                }
            }
        )()
    </script>

    </body>
</html>